<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>Patch FPGA image on Colossus DX 1x100G NIC</description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.plugins.buildblocker.BuildBlockerProperty plugin="build-blocker-plugin@1.4.1">
      <useBuildBlocker>false</useBuildBlocker>
    </hudson.plugins.buildblocker.BuildBlockerProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>STC_CHASSIS_IP</name>
          <description>IP address of Spirent TestCenter chassis</description>
          <defaultValue>10.100.21.109</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>STC_FPGA_DIR</name>
          <description>Directory on remote chassis where FPGA image files are located, example: /mnt/spirent/hypervisor/fpga</description>
          <defaultValue>/mnt/spirent/hypervisor/fpga</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>STC_VERSION</name>
          <description>Spirent TestCenter version to use for testing</description>
          <defaultValue>4.40</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>STC_INSTALLER_DEPOT</name>
          <description>Spirent TestCenter package repository</description>
          <defaultValue>/mnt/martin/archive/pv/TestCenter</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>STC_INSTALL_DIR</name>
          <description>Spirent TestCenter BLL/UI installation target directory</description>
          <defaultValue>stc_install_dir</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>10.2.20.68</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers class="vector"/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.plugins.copyartifact.CopyArtifact plugin="copyartifact@1.28">
      <project>hw_imp_colossus_dx_100g_nic</project>
      <filter>Vivado/Vivado.runs/impl_1/ColossusDX_1x100G.bit</filter>
      <target></target>
      <selector class="hudson.plugins.copyartifact.StatusBuildSelector"/>
      <flatten>true</flatten>
    </hudson.plugins.copyartifact.CopyArtifact>
    <hudson.tasks.Shell>
      <command>echo &quot;Copy FPGA image to remote STC chassis&quot;
#sshpass -f /etc/stc_chassis.pass scp -v -o StrictHostKeyChecking=no ./ColossusDX_1x100G.bit root@${STC_CHASSIS_IP}:${STC_FPGA_DIR}/ColossusDX_1x100G_jenkins.bit
sshpass -f /etc/stc_chassis.pass scp -o StrictHostKeyChecking=no ./ColossusDX_1x100G.bit root@${STC_CHASSIS_IP}:${STC_FPGA_DIR}/ColossusDX_1x100G_jenkins.bit

echo &quot;Configure FPGA image soft-link to remote STC chassis&quot;
#sshpass -f /etc/stc_chassis.pass ssh -t -v -o StrictHostKeyChecking=no root@${STC_CHASSIS_IP} &quot;cd ${STC_FPGA_DIR}; ln -sf ColossusDX_1x100G_jenkins.bit ${STC_FPGA_DIR}/ColossusDX_1x100G.bit&quot;
sshpass -f /etc/stc_chassis.pass ssh -o StrictHostKeyChecking=no root@${STC_CHASSIS_IP} &quot;cd ${STC_FPGA_DIR}; ln -sf ColossusDX_1x100G_jenkins.bit ${STC_FPGA_DIR}/ColossusDX_1x100G.bit&quot;


#sshpass -f /etc/stc_chassis.pass ssh -t -v -o StrictHostKeyChecking=no root@${STC_CHASSIS_IP} &quot;cd ${STC_FPGA_DIR}/; ls -al ColossusDX_1x100G.bit&quot;
#sshpass -f /etc/stc_chassis.pass ssh -o StrictHostKeyChecking=no root@${STC_CHASSIS_IP} &quot;cd ${STC_FPGA_DIR}/; ls -al ColossusDX_1x100G.bit&quot;
</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#prepare workspace
echo &quot;Preparing workspace&quot;
rm -rf ${STC_INSTALL_DIR}
mkdir -p ${STC_INSTALL_DIR}</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#copy BLL package to workspace
echo copy BLL package to work space
BLL_BUILD=`awk -F= &apos;{ if($1 == &quot;BLL&quot;) print $2 }&apos; &lt; ${STC_INSTALLER_DEPOT}/${STC_VERSION}/Engineering_Builds/latestbuild.txt`
BLL_BUILD=`echo ${BLL_BUILD} | tr -d &apos;\r&apos;`
BLL_PKG_DIR=${STC_INSTALLER_DEPOT}/${STC_VERSION}/Engineering_Builds/GUI_BLL/${BLL_BUILD}
echo BLL_PKG_DIR=${BLL_PKG_DIR}
#ls $BLL_PKG_DIR ;#&lt;&lt;&lt;debug
#cp -av ${BLL_PKG_DIR}/EL3Linux64Server/* ${STC_INSTALL_DIR} ;#&lt;&lt;&lt;packages have softlink issues, also requires 64-bit license
cp -av ${BLL_PKG_DIR}/Linux_EL3/* ${STC_INSTALL_DIR}</command>
    </hudson.tasks.Shell>
    <hudson.plugins.python.Python plugin="python@1.2">
      <command>import system
import time

from StcPython import StcPython

stc = StcPython()

stc.connect(STC_CHASSIS_IP)
hPhysicalChassis = stc.get(&quot;physicalchassismanager1&quot;, &quot;children-physicalchassis)
stc.perform(&quot;RebootEquipment&quot;, EquipmentList=hPhysicalChassis)</command>
    </hudson.plugins.python.Python>
    <hudson.tasks.Shell>
      <command>echo &quot;New FPGA version: &quot;
sshpass -f /etc/stc_chassis.pass ssh -o root@${STC_CHASSIS_IP} &quot;BAR0=`cat /proc/bus/pci/devices  | awk &apos;{ if ($2 == \&quot;174a0a05\&quot;) {print $4} }&apos;`; /mnt/spirent/hypervisor/fpga/peek32 $BAR0 | grep 0x$BAR0 | awk &apos;{ print $3}&apos;&quot;</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers>
    <hudson.plugins.timestamper.TimestamperBuildWrapper plugin="timestamper@1.5.7"/>
  </buildWrappers>
</project>